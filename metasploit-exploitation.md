we will learn how to use Metasploit for vulnerability scanning and exploitation.

the topics we will cover are:

1. How to scan target systems using Metasploit.

2. How to use the Metasploit database feature.

3. How to use Metasploit to conduct a vulnerability scan.

4. How to use Metasploit to exploit vulnerable services on target systems.

5. How msfvenom can be used to create payloads and obtain a Meterpreter session on the target system.

-----

 Scanning: 

 1. Port Scanning

		Metasploit has a number of modules to scan open ports on the target system and network. You can list potential port scanning modules available using the search portscan command.

Port scanning modules will require you to set a few options:

	CONCURRENCY: Number of targets to be scanned simultaneously.
	
	PORTS: Port range to be scanned. 
	
	RHOSTS: Target or target network to be scanned.
	
	THREADS: Number of threads that will be used simultaneously. More threads will result in faster scans.


2. UDP service Identification

		The scanner/discovery/udp_sweep module will allow you to quickly identify services running over the UDP (User Datagram Protocol).


3. SMB Scans

		Metasploit offers several useful auxiliary modules that allow us to scan specific services. Below is an example for the SMB. Especially useful in a corporate network would be smb_enumshares and smb_version

-----

The Metasploit Database : 

an actual penetration test includes several targets : 

Metasploit has a database function to simplify project management and avoid possible confusion when setting up parameter values. 

1. You will first need to start the PostgreSQL database, which Metasploit will use with the following command: 

systemctl start postgresql

2. Then you will need to initialize the Metasploit Database using the msfdb init command. 

3. You can now launch msfconsole and check the database status using the db_status command.

4. The database feature will allow you to create workspaces to isolate different projects. When first launched, you should be in the default workspace. You can list available workspaces using the workspace command. 

You can add a workspace using the -a parameter or delete a workspace using the -d parameter, respectively.

You will also notice that the new database name is printed in red, starting with a * symbol.


You can use the workspace -h command to list available options for the workspace command. 

Different from regular Metasploit usage, once Metasploit is launched with a database, the help command, you will show the Database Backends Commands menu.

If you run a Nmap scan using the db_nmap shown below, all results will be saved to the database. 

You can now reach information relevant to hosts and services running on target systems with the hosts and services commands, respectively. 

The hosts -h and services -h commands can help you become more familiar with available options. 


--------
Vulnerability Scanning : 


Metasploit allows you to quickly identify some critical vulnerabilities that could be considered as “low hanging fruit”.  The term “low hanging fruit” usually refers to easily identifiable and exploitable vulnerabilities that could potentially allow you to gain a foothold on a system and, in some cases, gain high-level privileges such as root or administrator.

use search command to search for vulnerable service : search "service_name"

	then use , use command to select the available exploit : use "path/to/exploit"

	You can use the info command for any module to have a better understanding of its use and purpose.


------

Exploitation: 

As the name suggests, Metasploit is an exploitation framework. Exploits are the most populated module category.

search - to search for an exploit 

exploit - to launch an exploit 

Most of the exploits will have a preset default payload. 
	
	However, you can always use the show payloads command to list other commands you can use with that specific exploit.

	Once you have decided on the payload, you can use the set payload command to make your choice.

Note that choosing a working payload could become a trial and error process due to environmental or OS restrictions such as firewall rules, anti-virus, file writing, or the program performing the payload execution isn't available.

Some payloads will open new parameters that you may need to set, running the show options command once more can show these. a reverse payload will at least require you to set the LHOST option.

ctrl + z to background a session 

ctrl +c to exit a session 



Working with sessions

The sessions command will list all active sessions. 

sessions -h to list our options 

You can interact with any existing session using the sessions -i command followed by the session ID.


-------

Msfvenom : 

Msfvenom, which replaced Msfpayload and Msfencode, allows you to generate payloads.

Msfvenom will allow you to access all payloads available in the  Metasploit framework.
 Msfvenom allows you to create payloads in many different formats (PHP, exe, dll, elf, etc.) 
 and for many different target systems (Apple, Windows, Android, Linux, etc.).

 <msfvenom -l payloads> to list payloads 

 	Output formats:

You can either generate stand-alone payloads (e.g. a Windows executable for Meterpreter) or get a usable raw format (e.g. python). Themsfvenom --list formats command can be used to list supported output formats

Encoders: 

encoders do not bypass antivirus , they encode our payloads which can be effective against some antivirus softwares , but using modern obfuscation or injecting shellcode is still better to bypass antivirus ,  -e to apply encoders 

Handlers : 

basically they are used to catch a shell or recieve reverse tcp connections , we need to start a handler before executing the payload on target so that we can successfully gain a shell , we can load metasploit handler as use/exploit/multi/handler

then set payload , lport , lhost and run it before executing our payload on target

 ------

 You should now have a better understanding of how Metasploit can help you identify potential vulnerabilities on target systems and exploit these vulnerabilities.


You have also seen how the database feature can help you with penetration testing engagements where you have multiple potential targets.
Finally,  This is especially helpful in situations where you can upload a file to the target system or have the ability to download files to the target system. Meterpreter is a powerful tool that offers a lot of easy to use features during the post-exploitation phase.

-----



