---
title: Exploitation
updated: 2022-06-08 12:25:10Z
created: 2022-06-08 11:34:36Z
---

so we got a proof of concept that target connected to us on netcat but we got a bunch of weird characters ,

now in this section we will do exploitation and get a proper shell on target 

so what are the steps here ? 

first , we will use a publicly available open source LDAP service known as " LDAP referral server 

then , after reaching to our malicious LDAP server it will redirect the request to a secondary http payload that we will create 

, at last the victim executes the malicious code and we will gain a shell. 

.

lets prepare out attack now , first we need a http server which we can create easily using either apache service or by using python http.server .

then we need a LDAP referral server , for which we will use marshalsec's tool on github :   https://github.com/mbechler/marshalsec

to use this tool it suggests to use java 8 , lets set that up : 

download this version for linux : https://www.oracle.com/in/java/technologies/javase/javase8-archive-downloads.html#license-lightbox

then run these commands on your terminal : 

```
sudo mkdir /usr/lib/jvm 
```

**cd /usr/lib/jvm**

**sudo tar xzvf ~/Downloads/jdk-8u181-linux-x64.tar.gz # modify as needed**

**sudo update-alternatives --install "/usr/bin/java" "java" "/usr/lib/jvm/jdk1.8.0\_181/bin/java" 1 sudo update-alternatives --install "/usr/bin/javac" "javac" "/usr/lib/jvm/jdk1.8.0\_181/bin/javac" 1 sudo update-alternatives --install "/usr/bin/javaws" "javaws" "/usr/lib/jvm/jdk1.8.0_181/bin/javaws" 1**

**sudo update-alternatives --set java /usr/lib/jvm/jdk1.8.0\_181/bin/java sudo update-alternatives --set javac /usr/lib/jvm/jdk1.8.0\_181/bin/javac sudo update-alternatives --set javaws /usr/lib/jvm/jdk1.8.0_181/bin/javaws**

**.**

**and **after this we will have java 8 installed to our system : 

![7e26f76a8c11be4c4e7be88b49680e6d.png](../_resources/7e26f76a8c11be4c4e7be88b49680e6d.png)

to build our LDAP server using this tool we will need maven tool , lets install that : 

![0d39e245d5112ae67b149cb9d75a66c5.png](../_resources/0d39e245d5112ae67b149cb9d75a66c5.png)

now lets build marshalsec tool : 

![c8f94530f13905ceb5bc3ef291f7cf39.png](../_resources/c8f94530f13905ceb5bc3ef291f7cf39.png)

\* it will take some time . 

after that 

lets create our payload , which we will create using java , 

our exploit : 

![91cd900a99df1cc0c179852159235086.png](../_resources/91cd900a99df1cc0c179852159235086.png)

replace that ip with your machine ip and port as the port you will listen using netcat . 

save it and compile it like this : 

![b61a85accc3d2819eab1d3881e3982b0.png](../_resources/b61a85accc3d2819eab1d3881e3982b0.png)

now lets set-up your marshal LDAP referral server : 

![0e4b4a8b84cc2477ac0779c50349671a.png](../_resources/0e4b4a8b84cc2477ac0779c50349671a.png)

after that run your python server in the exploit directory on port 8000: 

**![4526a84c450e8aaaa4439a5e4f247b17.png](../_resources/4526a84c450e8aaaa4439a5e4f247b17.png)**

**setting up the listener : **

**![8733a66d7b2227b55ce432b17688ed77.png](../_resources/8733a66d7b2227b55ce432b17688ed77.png)**

**then run our payload directing our target to our LDAP server : **

**![64fc95c88cd20ffb058f97bf08006750.png](../_resources/64fc95c88cd20ffb058f97bf08006750.png)**

**and then see your netcat and we will have a shell : **

**![0144a1fa7b4c7d63a588849096daa6ce.png](../_resources/0144a1fa7b4c7d63a588849096daa6ce.png)**